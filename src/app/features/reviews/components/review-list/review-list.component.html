<div class="review-list-container">
  <!-- Filters Section -->
  <div class="filters-section" *ngIf="showFilters">
    <mat-card class="filters-card">
      <div class="filters-row">
        <!-- Search -->
        <mat-form-field appearance="outline" class="search-field">
          <mat-label>Search reviews</mat-label>
          <input matInput 
                 [(ngModel)]="searchQuery" 
                 (ngModelChange)="onSearchChange()"
                 placeholder="Search by content...">
          <mat-icon matSuffix>search</mat-icon>
        </mat-form-field>

        <!-- Rating Filter -->
        <mat-form-field appearance="outline" class="filter-field">
          <mat-label>Rating</mat-label>
          <mat-select [(ngModel)]="ratingFilter" (selectionChange)="onFilterChange()">
            <mat-option *ngFor="let option of ratingOptions" [value]="option.value">
              {{ option.label }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <!-- Verified Filter -->
        <mat-form-field appearance="outline" class="filter-field">
          <mat-label>Verified</mat-label>
          <mat-select [(ngModel)]="verifiedFilter" (selectionChange)="onFilterChange()">
            <mat-option *ngFor="let option of verifiedOptions" [value]="option.value">
              {{ option.label }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <!-- Sort -->
        <mat-form-field appearance="outline" class="filter-field">
          <mat-label>Sort by</mat-label>
          <mat-select [(ngModel)]="sortBy" (selectionChange)="onFilterChange()">
            <mat-option *ngFor="let option of sortOptions" [value]="option.value">
              {{ option.label }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <!-- Sort Order -->
        <button mat-icon-button 
                (click)="sortOrder = sortOrder === 'asc' ? 'desc' : 'asc'; onFilterChange()"
                [matTooltip]="sortOrder === 'asc' ? 'Sort Ascending' : 'Sort Descending'">
          <mat-icon>{{ sortOrder === 'asc' ? 'arrow_upward' : 'arrow_downward' }}</mat-icon>
        </button>
      </div>
    </mat-card>
  </div>

  <!-- Loading State -->
  <div class="loading-container" *ngIf="loading">
    <app-loading-spinner></app-loading-spinner>
  </div>

  <!-- Reviews List -->
  <div class="reviews-container" *ngIf="!loading">
    <!-- Empty State -->
    <div class="empty-state" *ngIf="reviews.length === 0">
      <mat-icon class="empty-icon">rate_review</mat-icon>
      <h3>No reviews found</h3>
      <p>There are no reviews matching your criteria.</p>
    </div>

    <!-- Reviews -->
    <div class="reviews-list" *ngIf="reviews.length > 0">
      <mat-card class="review-card" *ngFor="let review of reviews" (click)="onReviewClick(review)">
        <mat-card-header>
          <div class="review-header">
            <div class="user-info">
              <div class="user-avatar">
                <mat-icon>person</mat-icon>
              </div>
              <div class="user-details">
                <h4 class="user-name">{{ review.user.firstName }} {{ review.user.lastName }}</h4>
                <div class="review-meta">
                  <div class="rating-stars">
                    <mat-icon *ngFor="let star of getRatingStars(review.rating)" class="star filled">star</mat-icon>
                    <mat-icon *ngFor="let star of getEmptyStars(review.rating)" class="star empty">star_border</mat-icon>
                  </div>
                  <span class="review-date">{{ getTimeAgo(review.createdAt) }}</span>
                  <mat-chip *ngIf="review.isVerified" class="verified-chip" color="primary" selected>
                    <mat-icon matChipAvatar>verified</mat-icon>
                    Verified
                  </mat-chip>
                </div>
              </div>
            </div>

            <div class="review-actions">
              <button mat-icon-button 
                      [matMenuTriggerFor]="reviewMenu"
                      (click)="$event.stopPropagation()">
                <mat-icon>more_vert</mat-icon>
              </button>
              <mat-menu #reviewMenu="matMenu">
                <button mat-menu-item (click)="onLikeReview(review)">
                  <mat-icon>{{ review.isLiked ? 'favorite' : 'favorite_border' }}</mat-icon>
                  <span>{{ review.isLiked ? 'Unlike' : 'Like' }}</span>
                </button>
                <button mat-menu-item (click)="onReportReview(review)">
                  <mat-icon>flag</mat-icon>
                  <span>Report</span>
                </button>
                <button mat-menu-item (click)="onDeleteReview(review)" class="delete-action">
                  <mat-icon>delete</mat-icon>
                  <span>Delete</span>
                </button>
              </mat-menu>
            </div>
          </div>
        </mat-card-header>

        <mat-card-content>
          <div class="review-content">
            <h5 class="review-title" *ngIf="review.title">{{ review.title }}</h5>
            <p class="review-text">{{ review.comment }}</p>
            
            <!-- Review Images -->
            <div class="review-images" *ngIf="review.images && review.images.length > 0">
              <img *ngFor="let image of review.images" 
                   [src]="image" 
                   [alt]="'Review image'"
                   class="review-image">
            </div>

            <!-- Review Tags -->
            <div class="review-tags" *ngIf="review.tags && review.tags.length > 0">
              <mat-chip *ngFor="let tag of review.tags" class="tag-chip">
                {{ tag }}
              </mat-chip>
            </div>
          </div>

          <mat-divider></mat-divider>

          <div class="review-footer">
            <div class="review-stats">
              <button mat-button 
                      (click)="onLikeReview(review); $event.stopPropagation()"
                      [class.liked]="review.isLiked">
                <mat-icon>{{ review.isLiked ? 'favorite' : 'favorite_border' }}</mat-icon>
                <span>{{ review.likes || 0 }}</span>
              </button>
              <span class="helpful-count" *ngIf="review.helpful > 0">
                {{ review.helpful }} people found this helpful
              </span>
            </div>
          </div>
        </mat-card-content>
      </mat-card>
    </div>
  </div>

  <!-- Pagination -->
  <div class="pagination-container" *ngIf="showPagination && reviews.length > 0">
    <mat-paginator
      [length]="totalReviews"
      [pageSize]="pageSize"
      [pageSizeOptions]="pageSizeOptions"
      [pageIndex]="currentPage - 1"
      (page)="onPageChange($event)"
      showFirstLastButtons>
    </mat-paginator>
  </div>
</div>
